import{r as E,F as S,f as k,b as P,d as N,B as F,G as C,j as e,E as B}from"./index-7m9_wtS-.js";import{z as l,u as R,t as T,I as d}from"./Input-qtKQbNQh.js";import{H as q}from"./Heading-FDvezrQq.js";import{R as H,C as D}from"./Row-4Vo06hVD.js";import{F as I,S as L}from"./Spinner-Y211hU-L.js";import{B as U}from"./Button-Z-SpEbro.js";import"./index-HPGscYs6.js";import"./Button-NuOupjTS.js";const z=l.object({firstName:l.string().min(1,{message:"First name is required"}),lastName:l.string().min(1,{message:"Last name is required"}),email:l.string().min(1,{message:"Email address is required"}).email(),password:l.string().min(8,{message:"Password must be at least 8 characters longs"}).regex(/.*[!@#$%^&*()_+{}|[\]\\:";'<>?,./].*/,{message:"Password should contain at least 1 special character"}),confirmPassword:l.string().min(1,{message:"Confirm Password is required"})}).refine(s=>s.password===s.confirmPassword,{message:"Password and Confirm Password does not match",path:["confirmPassword"]}),O=()=>{const[s,r]=E.useState("idle"),[o,a]=E.useState(null);return{emailAvailabilityStatus:s,enteredEmail:o,checkEmailAvailability:async i=>{a(i),r("checking");try{(await S.get(`/users?email=${i}`)).data.length?r("notAvailable"):r("available")}catch{r("failed")}},resetCheckEmailAvailability:()=>{r("idle"),a(null)}}},_=()=>{const s=k(),r=P(),{loading:o,error:a,accessToken:t}=N(c=>c.auth),{register:u,handleSubmit:i,getFieldState:n,trigger:x,formState:{errors:g}}=R({mode:"onBlur",resolver:T(z)}),f=async c=>{const{firstName:v,lastName:w,email:y,password:A}=c;s(C({firstName:v,lastName:w,email:y,password:A})).unwrap().then(()=>{r("/login?message=account_created")})},{emailAvailabilityStatus:h,enteredEmail:m,checkEmailAvailability:p,resetCheckEmailAvailability:b}=O(),j=async c=>{await x("email");const v=c.target.value,{isDirty:w,invalid:y}=n("email");w&&!y&&m!==v&&p(v),w&&y&&m&&b()};return E.useEffect(()=>()=>{s(F())},[s]),{loading:o,error:a,accessToken:t,formErrors:g,emailAvailabilityStatus:h,submitForm:f,register:u,handleSubmit:i,emailOnBlurHandler:j}},X=()=>{var g,f,h,m,p,b;const{loading:s,error:r,accessToken:o,formErrors:a,emailAvailabilityStatus:t,submitForm:u,register:i,handleSubmit:n,emailOnBlurHandler:x}=_();return o?e.jsx(B,{to:"/"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"User Registration"}),e.jsx(H,{children:e.jsx(D,{md:{span:6,offset:3},children:e.jsxs(I,{onSubmit:n(u),children:[e.jsx(d,{label:"First Name",name:"firstName",register:i,error:(g=a.firstName)==null?void 0:g.message}),e.jsx(d,{label:"Last Name",name:"lastName",register:i,error:(f=a.lastName)==null?void 0:f.message}),e.jsx(d,{label:"Email Address",name:"email",register:i,onBlur:x,error:(h=a.email)!=null&&h.message?(m=a.email)==null?void 0:m.message:t==="notAvailable"?"This email is already in use.":t==="failed"?"Error from the server.":"",formText:t==="checking"?"We're currently checking the availability of this email address. Please wait a moment.":"",success:t==="available"?"This email is available for use.":"",disabled:t==="checking"}),e.jsx(d,{type:"password",label:"Password",name:"password",register:i,error:(p=a.password)==null?void 0:p.message}),e.jsx(d,{type:"password",label:"Confirm Password",name:"confirmPassword",register:i,error:(b=a.confirmPassword)==null?void 0:b.message}),e.jsx(U,{variant:"info",type:"submit",style:{color:"white"},disabled:t==="checking"?!0:s==="pending",children:s==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(L,{animation:"border",size:"sm"})," Loading..."]}):"Submit"}),r&&e.jsx("p",{style:{color:"#DC3545",marginTop:"10px"},children:r})]})})})]})};export{X as default};
