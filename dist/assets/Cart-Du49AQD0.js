import{j as e,f as b,r as l,n as v,o as k,d as f,p as w,q as F,s as I,t as P,v as O,w as C}from"./index-w5WXYR20.js";import{H as L}from"./Heading-byprMz6S.js";import{C as A,M as u,a as S,L as E}from"./styles.module-IzXs-fqV.js";import{B as y}from"./Button-B8bqqsnv.js";import{S as B}from"./Spinner-jRSRzx3H.js";import"./Row-9IJhNHLd.js";import"./CloseButton-d28tGAbJ.js";import"./useEventCallback-cqNgmRpt.js";import"./index-VvQZwdVc.js";import"./AbstractModalHeader-YBWbD3sk.js";import"./DataKey-N3U1ILTk.js";import"./Button-MA_ylKNZ.js";const T=({products:s,changeQuantityHandler:o,removeItemHandler:r})=>{const n=s.map(a=>e.jsx(A,{...a,changeQuantityHandler:o,removeItemHandler:r},a.id));return e.jsx("div",{children:n})},q=({products:s,userAccessToken:o})=>{const r=b(),[n,a]=l.useState(!1),[c,i]=l.useState(null),[p,m]=l.useState(!1),d=s.reduce((h,g)=>{const H=g.price,j=g.quantity;return j&&typeof j=="number"?h+H*j:h},0),t=()=>{m(!p),i(null)},x=()=>{a(!0),r(v(d)).unwrap().then(()=>{r(k()),m(!1)}).catch(h=>{i(h)}).finally(()=>a(!1))};return e.jsxs(e.Fragment,{children:[e.jsxs(u,{show:p,onHide:t,backdrop:"static",children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Placing Order"})}),e.jsxs(u.Body,{children:["Are you sure you want to place order with Subtotal:"," ",d.toFixed(2)," EGP",!n&&c&&e.jsx("p",{style:{color:"#DC3545",marginTop:"10px"},children:c})]}),e.jsxs(u.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:t,children:"Close"}),e.jsx(y,{variant:"info",style:{color:"white"},onClick:x,children:n?e.jsxs(e.Fragment,{children:[e.jsx(B,{animation:"border",size:"sm"})," Loading..."]}):"Confirm"})]})]}),e.jsxs("div",{className:S.container,children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[d.toFixed(2)," EGP"]})]}),o&&e.jsxs("div",{className:S.container,children:[e.jsx("span",{children:" "}),e.jsx("span",{children:e.jsx(y,{variant:"info",style:{color:"white"},onClick:t,children:"Place Order"})})]})]})},M=()=>{const s=b(),{items:o,productsFullInfo:r,loading:n,error:a}=f(t=>t.cart),c=f(t=>t.auth.accessToken),i=f(t=>t.orders.loading),p=l.useCallback((t,x)=>{s(w({id:t,quantity:x}))},[s]),m=l.useCallback(t=>{s(F(t))},[s]),d=r.map(t=>({...t,quantity:o[t.id]}));return l.useEffect(()=>{const t=s(I());return()=>{t.abort(),s(P()),s(O())}},[s]),{loading:n,error:a,products:d,userAccessToken:c,placeOrderStatus:i,changeQuantityHandler:p,removeItemHandler:m}},X=()=>{const{loading:s,error:o,products:r,userAccessToken:n,placeOrderStatus:a,changeQuantityHandler:c,removeItemHandler:i}=M();return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Your Cart"}),e.jsx(E,{status:s,error:o,type:"cart",children:r.length?e.jsxs(e.Fragment,{children:[e.jsx(T,{products:r,changeQuantityHandler:c,removeItemHandler:i}),e.jsx(q,{products:r,userAccessToken:n})]}):a==="succeeded"?e.jsx(C,{message:"Your order has been placed successfully",type:"success"}):e.jsx(C,{message:"Your cart is empty",type:"empty"})})]})};export{X as default};
